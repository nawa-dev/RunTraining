<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Running Timer</title>

<meta name="viewport" content="width=390, initial-scale=1, maximum-scale=1, user-scalable=no">

<style>
html, body {
    width: 390px;
    max-width: 390px;
    overflow-x: hidden;
}

* { box-sizing: border-box; }

body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #0f172a;
    color: white;
    margin: 0 auto;
    padding: 10px;
}

button {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    transition: transform 0.08s ease;
}

button:active {
    transform: scale(0.95);
}

.time {
    font-size: 56px;
    text-align: center;
    margin: 10px 0;
    font-weight: bold;
}

.row {
    display: flex;
    gap: 8px;
}

.btn {
    width: 100%;
    padding: 16px;
    margin: 6px 0;
    font-size: 20px;
    border-radius: 12px;
    color: #ffffff;
    border: none;

    display: flex;
    align-items: center;
    justify-content: center;
}

.start { background: #22c55e; }
.stop  { background: #ef4444; }
.reset { background: #64748b; }

.lap-circle {
    width: 160px;
    height: 160px;
    border-radius: 50%;
    border: none;
    background: #3b82f6;
    color: white;
    font-size: 30px;
    margin: 16px auto;

    display: flex;
    align-items: center;
    justify-content: center;
}

.lap-item {
    background: #1e293b;
    padding: 12px;
    border-radius: 10px;
    margin: 6px 0;
    font-size: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.lap-pace {
    font-size: 26px;
    font-weight: bold;
    color: #38bdf8;
    text-align: right;
}

input {
    width: 100%;
    padding: 12px;
    font-size: 18px;
    border-radius: 10px;
    border: none;
    margin-bottom: 8px;
}
</style>
</head>

<body>

<h2>üèÉ Timer ‡∏ã‡πâ‡∏≠‡∏°‡∏ß‡∏¥‡πà‡∏á</h2>

<!-- üëá ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏ï‡∏£ -->
<input id="distance" placeholder="‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ï‡πà‡∏≠‡∏£‡∏≠‡∏ö (‡πÄ‡∏°‡∏ï‡∏£) ‡πÄ‡∏ä‡πà‡∏ô 400">

<div class="time" id="display">00:00.00</div>

<div class="row">
    <button class="btn start" onclick="start()">‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
    <button class="btn stop" onclick="stop()">‚è∏ ‡∏´‡∏¢‡∏∏‡∏î</button>
    <button class="btn reset" onclick="resetAll()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
</div>

<button class="lap-circle" onclick="lap()">‡∏ô‡∏±‡∏ö‡∏£‡∏≠‡∏ö</button>


<h3>‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πà‡∏á</h3>
<div id="laps"></div>

<script>
let startTime = 0;
let elapsed = 0;
let timer;
let running = false;
let lastLapTime = 0;
let lapCount = 0;
let lapsData = [];

/* ‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏ã‡πâ‡∏≥ */
let lastPress = 0;
function canPress() {
    const now = Date.now();
    if (now - lastPress < 400) return false;
    lastPress = now;
    return true;
}

/* STORAGE */
function save() {
    const data = {
        elapsed,
        lastLapTime,
        lapCount,
        lapsData,
        distance: distance.value,
        running
    };
    localStorage.setItem("runTimer", JSON.stringify(data));
}

function load() {
    const txt = localStorage.getItem("runTimer");
    if (!txt) return;

    try {
        const d = JSON.parse(txt);

        elapsed = d.elapsed || 0;
        lastLapTime = d.lastLapTime || 0;
        lapCount = d.lapCount || 0;
        lapsData = d.lapsData || [];
        distance.value = d.distance || "";

        renderLaps();
        display.innerText = format(elapsed);

        if (d.running) {
            running = true;
            startTime = Date.now() - elapsed;
            timer = setInterval(update, 30);
        }

    } catch(e) {}
}

/* UTIL */
function format(t) {
    let ms = Math.floor((t % 1000) / 10);
    let s = Math.floor(t / 1000) % 60;
    let m = Math.floor(t / 60000);

    return (
        String(m).padStart(2,'0') + ":" +
        String(s).padStart(2,'0') + "." +
        String(ms).padStart(2,'0')
    );
}

function vibrate() {
    if ("vibrate" in navigator) navigator.vibrate(40);
}

/* üëá ‡πÅ‡∏Å‡πâ‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö "‡πÄ‡∏°‡∏ï‡∏£" */
function calcPace(timeMs, meter) {
    if (!meter || meter <= 0) return "-";

    const km = meter / 1000;          // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏¥‡πÇ‡∏•
    let sec = timeMs / 1000;
    let paceSec = sec / km;

    let m = Math.floor(paceSec / 60);
    let s = Math.floor(paceSec % 60);

    return m + ":" + String(s).padStart(2,'0');
}

function update() {
    elapsed = Date.now() - startTime;
    display.innerText = format(elapsed);
    save();
}

function start() {
    if (!canPress() || running) return;

    running = true;
    startTime = Date.now() - elapsed;
    timer = setInterval(update, 30);
    save();
}

function stop() {
    if (!canPress()) return;

    running = false;
    clearInterval(timer);
    save();
}

function lap() {
    if (!canPress()) return;

    vibrate();

    /* üëá ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏ï‡∏£ */
    let distMeter = parseFloat(distance.value);

    let lapTime = elapsed - lastLapTime;

    lastLapTime = elapsed;
    lapCount++;

    let pace = calcPace(lapTime, distMeter);

    const item = {
        no: lapCount,
        lapTime,
        total: elapsed,
        pace
    };

    lapsData.unshift(item);

    renderLaps();
    save();
}

function renderLaps() {
    laps.innerHTML = lapsData.map(i => `
        <div class="lap-item">
            <div>
                <b>‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${i.no}</b><br>
                ‚è± ${format(i.lapTime)}<br>
                üïí ${format(i.total)}
            </div>

            <div class="lap-pace">
                ‚ö° ${i.pace}<br>
                <span style="font-size:14px">/km</span>
            </div>
        </div>
    `).join("");
}

function resetAll() {
    if (!canPress()) return;
    if (!confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) return;

    clearInterval(timer);

    startTime = 0;
    elapsed = 0;
    running = false;
    lastLapTime = 0;
    lapCount = 0;
    lapsData = [];

    display.innerText = "00:00.00";
    laps.innerHTML = "";

    localStorage.removeItem("runTimer");
}

load();
window.addEventListener("beforeunload", save);
</script>

</body>
</html>
